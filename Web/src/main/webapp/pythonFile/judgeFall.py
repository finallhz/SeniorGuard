# -*- coding: utf-8 -*-
"""
Created on Fri Jul  3 08:28:37 2020

@author: LHZ
"""

import numpy
import joblib
import os
import sys
#字符串修改为二维数组
def dataProc(dataset):
    dataArr = dataset.replace("[","").replace("]","").strip().split(",")
    for i in range(len(dataArr)):
        dataArr[i] = dataArr[i].strip().split(" ")
    return dataArr

#提取特征向量
def distribution(dataset):
    dataArr = dataProc(dataset)
    feaValue = numpy.zeros(6)
    for i in range(1,len(dataArr)):
        preLine=dataArr[i-1]
        curLine=dataArr[i]
        if(len(curLine)<9):
            continue
        del preLine[6:9]
        del curLine[6:9]
        preLine = [ float(x) for x in preLine ]  
        curLine = [ float(x) for x in curLine ]
        feaValue += (numpy.array(curLine) - numpy.array(preLine)) ** 2
    feaValue = ((feaValue/100) ** 0.5)
    #print(feaValue)
    return feaValue

#模型预测
def fallPrediction(feaData):
    currPath = sys.path[0]
    clf = joblib.load(currPath+'\\feaDataModel.pkl')
    feaData = feaData.reshape(1,-1)
    pred_y = clf.predict(feaData)
    return pred_y[0]

#dataset="[-0.819097 -2.931504 6.330037 0.917519 -0.091630 -0.287107 80 30 1607399463 , -0.775986 -2.914739 6.375542 0.917519 -0.091630 -0.287107 80 30 1607399463 , -0.840652 -2.718347 6.531219 0.917519 -0.091630 -0.287107 80 30 1607399463 , -0.943638 -2.629732 6.593489 0.917519 -0.091630 -0.287107 80 30 1607399463 , -0.946033 -2.378254 6.514453 0.917519 -0.091630 -0.287107 80 30 1607399463 , -0.732876 -2.258503 6.737190 0.917519 -0.091630 -0.287107 80 30 1607399463 , -0.732876 -2.258503 6.737190 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.450264 -2.356699 6.909632 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.450264 -2.418970 7.034173 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.490979 -2.579436 7.230564 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.649050 -2.792593 7.429351 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.809517 -2.869234 7.515572 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.514929 -2.902764 7.680828 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.411943 -3.135081 8.025711 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.366438 -3.460803 8.401729 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.366438 -3.460803 8.401729 0.201585 0.025656 0.256563 80 30 1607399463 , -0.371228 -3.671565 8.648416 0.201585 0.025656 0.256563 80 30 1607399463 , -0.421523 -3.741021 8.765772 0.201585 0.025656 0.256563 80 30 1607399463 , -0.505349 -3.568579 9.014853 0.201585 0.025656 0.256563 80 30 1607399463 , -0.445474 -3.609295 9.259146 0.201585 0.025656 0.256563 80 30 1607399463 , -0.397573 -3.776946 9.338181 0.201585 0.025656 0.256563 80 30 1607399463 , -0.385598 -3.810476 9.321417 0.201585 0.025656 0.256563 80 30 1607399463 , -0.397573 -3.314707 9.438772 0.201585 0.025656 0.256563 80 30 1607399463 , 0.021555 -2.284849 9.228010 0.201585 0.025656 0.256563 80 30 1607399463 , 0.021555 -2.284849 9.228010 -0.245568 0.125838 0.316428 80 30 1607399463 , -0.244292 -1.257385 9.273516 -0.245568 0.125838 0.316428 80 30 1607399463 , -0.378413 -1.209485 9.424402 -0.245568 0.125838 0.316428 80 30 1607399463 , -0.117356 -1.281335 9.611214 -0.245568 0.125838 0.316428 80 30 1607399463 , 0.143701 -1.458567 9.810000 -0.245568 0.125838 0.316428 80 30 1607399463 , 0.143701 -1.882485 9.929751 -0.245568 0.125838 0.316428 80 30 1607399463, -0.819097 -2.931504 6.330037 0.917519 -0.091630 -0.287107 80 30 1607399463 , -0.775986 -2.914739 6.375542 0.917519 -0.091630 -0.287107 80 30 1607399463 , -0.840652 -2.718347 6.531219 0.917519 -0.091630 -0.287107 80 30 1607399463 , -0.943638 -2.629732 6.593489 0.917519 -0.091630 -0.287107 80 30 1607399463 , -0.946033 -2.378254 6.514453 0.917519 -0.091630 -0.287107 80 30 1607399463 , -0.732876 -2.258503 6.737190 0.917519 -0.091630 -0.287107 80 30 1607399463 , -0.732876 -2.258503 6.737190 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.450264 -2.356699 6.909632 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.450264 -2.418970 7.034173 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.490979 -2.579436 7.230564 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.649050 -2.792593 7.429351 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.809517 -2.869234 7.515572 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.514929 -2.902764 7.680828 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.411943 -3.135081 8.025711 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.366438 -3.460803 8.401729 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.366438 -3.460803 8.401729 0.201585 0.025656 0.256563 80 30 1607399463 , -0.371228 -3.671565 8.648416 0.201585 0.025656 0.256563 80 30 1607399463 , -0.421523 -3.741021 8.765772 0.201585 0.025656 0.256563 80 30 1607399463 , -0.505349 -3.568579 9.014853 0.201585 0.025656 0.256563 80 30 1607399463 , -0.445474 -3.609295 9.259146 0.201585 0.025656 0.256563 80 30 1607399463 , -0.397573 -3.776946 9.338181 0.201585 0.025656 0.256563 80 30 1607399463 , -0.385598 -3.810476 9.321417 0.201585 0.025656 0.256563 80 30 1607399463 , -0.397573 -3.314707 9.438772 0.201585 0.025656 0.256563 80 30 1607399463 , 0.021555 -2.284849 9.228010 0.201585 0.025656 0.256563 80 30 1607399463 , 0.021555 -2.284849 9.228010 -0.245568 0.125838 0.316428 80 30 1607399463 , -0.244292 -1.257385 9.273516 -0.245568 0.125838 0.316428 80 30 1607399463 , -0.378413 -1.209485 9.424402 -0.245568 0.125838 0.316428 80 30 1607399463 , -0.117356 -1.281335 9.611214 -0.245568 0.125838 0.316428 80 30 1607399463 , 0.143701 -1.458567 9.810000 -0.245568 0.125838 0.316428 80 30 1607399463 , 0.143701 -1.882485 9.929751 -0.245568 0.125838 0.316428 80 30 1607399463, -0.819097 -2.931504 6.330037 0.917519 -0.091630 -0.287107 80 30 1607399463 , -0.775986 -2.914739 6.375542 0.917519 -0.091630 -0.287107 80 30 1607399463 , -0.840652 -2.718347 6.531219 0.917519 -0.091630 -0.287107 80 30 1607399463 , -0.943638 -2.629732 6.593489 0.917519 -0.091630 -0.287107 80 30 1607399463 , -0.946033 -2.378254 6.514453 0.917519 -0.091630 -0.287107 80 30 1607399463 , -0.732876 -2.258503 6.737190 0.917519 -0.091630 -0.287107 80 30 1607399463 , -0.732876 -2.258503 6.737190 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.450264 -2.356699 6.909632 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.450264 -2.418970 7.034173 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.490979 -2.579436 7.230564 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.649050 -2.792593 7.429351 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.809517 -2.869234 7.515572 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.514929 -2.902764 7.680828 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.411943 -3.135081 8.025711 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.366438 -3.460803 8.401729 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.366438 -3.460803 8.401729 0.201585 0.025656 0.256563 80 30 1607399463 , -0.371228 -3.671565 8.648416 0.201585 0.025656 0.256563 80 30 1607399463 , -0.421523 -3.741021 8.765772 0.201585 0.025656 0.256563 80 30 1607399463 , -0.505349 -3.568579 9.014853 0.201585 0.025656 0.256563 80 30 1607399463 , -0.445474 -3.609295 9.259146 0.201585 0.025656 0.256563 80 30 1607399463 , -0.397573 -3.776946 9.338181 0.201585 0.025656 0.256563 80 30 1607399463 , -0.385598 -3.810476 9.321417 0.201585 0.025656 0.256563 80 30 1607399463 , -0.397573 -3.314707 9.438772 0.201585 0.025656 0.256563 80 30 1607399463 , 0.021555 -2.284849 9.228010 0.201585 0.025656 0.256563 80 30 1607399463 , 0.021555 -2.284849 9.228010 -0.245568 0.125838 0.316428 80 30 1607399463 , -0.244292 -1.257385 9.273516 -0.245568 0.125838 0.316428 80 30 1607399463 , -0.378413 -1.209485 9.424402 -0.245568 0.125838 0.316428 80 30 1607399463 , -0.117356 -1.281335 9.611214 -0.245568 0.125838 0.316428 80 30 1607399463 , 0.143701 -1.458567 9.810000 -0.245568 0.125838 0.316428 80 30 1607399463 , 0.143701 -1.882485 9.929751 -0.245568 0.125838 0.316428 80 30 1607399463, -0.819097 -2.931504 6.330037 0.917519 -0.091630 -0.287107 80 30 1607399463 , -0.775986 -2.914739 6.375542 0.917519 -0.091630 -0.287107 80 30 1607399463 , -0.840652 -2.718347 6.531219 0.917519 -0.091630 -0.287107 80 30 1607399463 , -0.943638 -2.629732 6.593489 0.917519 -0.091630 -0.287107 80 30 1607399463 , -0.946033 -2.378254 6.514453 0.917519 -0.091630 -0.287107 80 30 1607399463 , -0.732876 -2.258503 6.737190 0.917519 -0.091630 -0.287107 80 30 1607399463 , -0.732876 -2.258503 6.737190 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.450264 -2.356699 6.909632 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.450264 -2.418970 7.034173 0.778242 -0.101404 0.075747 80 30 1607399463 , -0.490979 -2.579436 7.230564 0.778242 -0.101404 0.075747 80 30 1607399463 ]";
#feaValue = distribution(dataset)
#pred_y = fallPrediction(feaValue)
#print(pred_y)
    
if __name__ == '__main__':
    feaValue = distribution(sys.argv[1])
    currPath = sys.path[0]
    pred_y = fallPrediction(feaValue)
    print(pred_y)

'''
with open(currPath+'\\receiveData.csv', 'a') as f1:
        feaValue = feaValue.tolist()
        feaValue = [str(x) for x in feaValue]
        feaValue.append(str(pred_y))
        feaValue.append('\n')
        f1.write(" ".join(feaValue))
'''